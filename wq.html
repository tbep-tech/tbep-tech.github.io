---
title: "Get EPCHC Data, Tidy it Up & Perform TBEP Annual WQ Assessment"
author: "Ed Sherwood <esherwood@tbep.org>, Ben Best <ben@ecoquants.com>, Marcus Beck <marcusb@sccwrp.org>"
date: "2019-07-09 21:31"
output: 
  html_document: 
    code_folding: hide
    toc: yes
    toc_float: yes
---

Original: [esherwoo77/pull_epc_data:pull_epc_data.Rmd](https://github.com/esherwoo77/pull_epc_data/blob/master/pull_epc_data.Rmd)


```r
knitr::opts_chunk$set(echo = TRUE, message = F, warning = F)

# libraries
library(leaflet)
library(here)
library(tbeptools) # remotes::install_github("tbep-tech/tbeptools")
# devtools::load_all('../tbeptools/.')

# local file path
xlsx <- here('data-raw', '2018_Results_Updated.xls')
```

## Download and import EPCHC dataset


```r
# load data and some light formatting
epcdata <- read_importwq(xlsx, download_latest_epchc = T)
```

```
## Error in readLines(con): Timeout was reached: Connection time-out
```

```r
epcdata
```

```
## Error in eval(expr, envir, enclos): object 'epcdata' not found
```


```r
#Display station locations
wqsites <- epcdata[, c('epchc_station', 'Latitude', 'Longitude')] %>% 
           unique()                                                   
```

```
## Error in eval(lhs, parent, parent): object 'epcdata' not found
```

```r
map <- leaflet(wqsites) %>%                                         
              addProviderTiles(providers$CartoDB.Positron) %>% 
              addCircleMarkers(~Longitude, ~Latitude,
                               radius = 6,
                               color = 'black',
                               stroke = FALSE,
                               opacity = 0.8,
                               popup = ~as.character(paste('EPC Station:', epchc_station)), 
                               group = 'Water quality') %>% 
              addLayersControl(overlayGroups = c('Water quality'),
                               options = layersControlOptions(collapsed = FALSE))
```

```
## Error in structure(list(options = options), leafletData = data): object 'wqsites' not found
```

```r
map
```

```
## Error in eval(expr, envir, enclos): object 'map' not found
```

## Plot Mean Annual Chl-a Values by Bay Segment {.tabset}

### Old Tampa Bay


```r
show_thrplot(epcdata, bay_segment = "OTB", thr = "chla")
```

```
## Error in eval(lhs, parent, parent): object 'epcdata' not found
```

### Hillsborough Bay


```r
show_thrplot(epcdata, bay_segment = "HB", thr = "chla")
```

```
## Error in eval(lhs, parent, parent): object 'epcdata' not found
```

### Middle Tampa Bay


```r
show_thrplot(epcdata, bay_segment = "MTB", thr = "chla")
```

```
## Error in eval(lhs, parent, parent): object 'epcdata' not found
```

### Lower Tampa Bay


```r
show_thrplot(epcdata, bay_segment = "LTB", thr = "chla")
```

```
## Error in eval(lhs, parent, parent): object 'epcdata' not found
```

## Plot Mean Annual Light Attenuation Values by Bay Segment {.tabset}

### Old Tampa Bay


```r
show_thrplot(epcdata, bay_segment = "OTB", thr = "la")
```

```
## Error in eval(lhs, parent, parent): object 'epcdata' not found
```

### Hillsborough Bay


```r
show_thrplot(epcdata, bay_segment = "HB", thr = "la")
```

```
## Error in eval(lhs, parent, parent): object 'epcdata' not found
```

### Middle Tampa Bay


```r
show_thrplot(epcdata, bay_segment = "MTB", thr = "la")
```

```
## Error in eval(lhs, parent, parent): object 'epcdata' not found
```

### Lower Tampa Bay


```r
show_thrplot(epcdata, bay_segment = "LTB", thr = "la")
```

```
## Error in eval(lhs, parent, parent): object 'epcdata' not found
```

## Colorized Table {.tabset}

Create a similer table as the one here: [tbep-tech:data/wq/TBEP_01_19_2018_**Decision_Matrix_Update**.pdf](https://drive.google.com/open?id=1NGq0VzaPv1_uxgoDkprVTAndSuBygSuq)
  

```r
knitr::include_graphics(here('img', 'decision-matrix_color-table-snip.png'))
```

<img src="/home/travis/build/tbep-tech/tbep-tech.github.io/img/decision-matrix_color-table-snip.png" title="plot of chunk unnamed-chunk-1" alt="plot of chunk unnamed-chunk-1" height="50%" />

### Chlorophyll


```r
show_matrix(epcdata, thr = 'chla')
```

```
## Error in eval(lhs, parent, parent): object 'epcdata' not found
```

### Light attenuation


```r
show_matrix(epcdata, thr = 'la')
```

```
## Error in eval(lhs, parent, parent): object 'epcdata' not found
```

