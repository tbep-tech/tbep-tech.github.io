---
title: "Get EPCHC Data, Tidy it Up & Perform TBEP Annual WQ Assessment"
author: "Ed Sherwood <esherwood@tbep.org>, Ben Best <ben@ecoquants.com>, Marcus Beck <marcusb@sccwrp.org>"
date: "`r format(Sys.time(), '%Y-%m-%d %H:%M')`"
output: 
  html_document: 
    code_folding: hide
    toc: yes
    toc_float: yes
---

```{r setup, include=F}
knitr::opts_chunk$set(echo = T, message = F, warning = F)

# libraries
library(here)
library(tbeptools) # remotes::install_github("tbep-tech/tbeptools")
# devtools::load_all('../tbeptools/.')

# local file path
xlsx <- here('data-raw', '2018_Results_Updated.xls')
```

## Download and import EPCHC dataset

```{r epchc_import}
# load data and some light formatting
epcdata <- read_importwq(xlsx, download_latest_epchc = T, tryurl = T, connecttimeout = 20)
epcdata
```

## Plot Mean Annual Chl-a Values by Bay Segment {.tabset}

### Old Tampa Bay

```{r chlplot_otb, fig.height = 5, fig.width = 8}
show_thrplot(epcdata, bay_segment = "OTB", thr = "chla")
```

### Hillsborough Bay

```{r chlplot_hb, fig.height = 5, fig.width = 8}
show_thrplot(epcdata, bay_segment = "HB", thr = "chla")
```

### Middle Tampa Bay

```{r chlplot_mtb, fig.height = 5, fig.width = 8}
show_thrplot(epcdata, bay_segment = "MTB", thr = "chla")
```

### Lower Tampa Bay

```{r chlplot_ltb, fig.height = 5, fig.width = 8}
show_thrplot(epcdata, bay_segment = "LTB", thr = "chla")
```

## Plot Mean Annual Light Attenuation Values by Bay Segment {.tabset}

### Old Tampa Bay

```{r laplot_otb, fig.height = 5, fig.width = 8}
show_thrplot(epcdata, bay_segment = "OTB", thr = "la")
```

### Hillsborough Bay

```{r laplot_hb, fig.height = 5, fig.width = 8}
show_thrplot(epcdata, bay_segment = "HB", thr = "la")
```

### Middle Tampa Bay

```{r laplot_mtb, fig.height = 5, fig.width = 8}
show_thrplot(epcdata, bay_segment = "MTB", thr = "la")
```

### Lower Tampa Bay

```{r laplot_ltb, fig.height = 5, fig.width = 8}
show_thrplot(epcdata, bay_segment = "LTB", thr = "la")
```

## Target attainment matrix {.tabset}

### Numerical results

```{r, fig.height = 12, fig.width = 4}
avedat <- anlz_avedat(epcdata)
anlz_attain(avedat, magdurout = T)
anlz_attain(avedat)
```

### Table with ggplot

```{r, fig.height = 12, fig.width = 4}
show_matrix(epcdata)
```

### Table with gt

```{r}
show_matrix(epcdata, tab = T)
```
